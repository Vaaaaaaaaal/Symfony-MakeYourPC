{% extends 'base.html.twig' %}

{% block title %}{{ product.name }} - MakeYourPC{% endblock %}

{% block body %}
    <div class="container product-detail">
        <div class="product-main">
            <div class="product-image-container">
                <img src="{{ asset('images/products/' ~ product.imagePath) }}" alt="{{ product.name }}" class="product-image">
            </div>
            
            <div class="product-info">
                <div class="product-header">
                    <span class="product-category">{{ product.type }}</span>
                    <h1>{{ product.name }}</h1>
                </div>

                <div class="product-rating">
                    {% for i in 1..5 %}
                        {% if i <= product.rating %}
                            <i data-lucide="star" class="star filled"></i>
                        {% elseif i <= product.rating + 0.5 %}
                            <i data-lucide="star-half" class="star filled"></i>
                        {% else %}
                            <i data-lucide="star" class="star"></i>
                        {% endif %}
                    {% endfor %}
                    <span class="rating-value">{{ product.rating|number_format(1) }}/5</span>
                </div>

                <div class="product-price">
                    {{ product.price|number_format(2, ',', ' ') }} â‚¬
                </div>

                <div class="product-stock {% if product.stock > 0 %}in-stock{% else %}out-of-stock{% endif %}">
                    {% if product.stock > 0 %}
                        <i data-lucide="check-circle"></i>
                        <span>En stock ({{ product.stock }} disponibles)</span>
                    {% else %}
                        <i data-lucide="x-circle"></i>
                        <span>Rupture de stock</span>
                    {% endif %}
                </div>

                {% if product.stock > 0 %}
                    <div class="product-actions">
                        <div class="quantity-selector">
                            <button type="button" class="quantity-btn" data-action="decrease">
                                <i data-lucide="minus"></i>
                            </button>
                            <input type="number" value="1" min="1" max="{{ product.stock }}" id="quantity">
                            <button type="button" class="quantity-btn" data-action="increase">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>
                        <button class="add-to-cart-btn" data-product-id="{{ product.id }}">
                            <i data-lucide="shopping-cart"></i>
                            Ajouter au panier
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            
            const quantityInput = document.getElementById('quantity');
            const maxStock = {{ product.stock }};
            
            function updateQuantity(action) {
                let currentValue = parseInt(quantityInput.value) || 1;
                
                if (action === 'decrease' && currentValue > 1) {
                    quantityInput.value = currentValue - 1;
                } else if (action === 'increase' && currentValue < maxStock) {
                    quantityInput.value = currentValue + 1;
                }
            }

            document.querySelectorAll('.quantity-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    updateQuantity(this.dataset.action);
                });
            });

            quantityInput.addEventListener('change', function() {
                let value = parseInt(this.value);
                if (isNaN(value) || value < 1) {
                    this.value = 1;
                } else if (value > maxStock) {
                    this.value = maxStock;
                }
            });
        });
    </script>
{% endblock %}